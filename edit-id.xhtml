<?xml version="1.0" encoding="utf-8"?>
<!--
    Copyright (C) 2010 Ethan Gruber
    nomisma: http://code.google.com/p/nomisma/
    Apache License 2.0: http://code.google.com/p/nomisma/    
-->
<xhtml:html xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:fr="http://orbeon.org/oxf/xml/form-runner" xmlns:exist="http://exist.sourceforge.net/NS/exist"
	xmlns:xxi="http://orbeon.org/oxf/xml/xinclude" xmlns:batlas="http://atlantides.org/batlas/" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:foaf="http://xmlns.com/foaf/0.1/" xmlns:gml="http://www.opengis.net/gml/" xmlns:nm="http://nomisma.org/id/" xmlns:ov="http://open.vocab.org/terms/" xmlns:owl="http://www.w3.org/2002/07/owl#"
	xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns:skos="http://www.w3.org/2008/05/skos#"
	xmlns:xhv="http://www.w3.org/1999/xhtml/vocab#" xmlns:xml="http://www.w3.org/XML/1998/namespace">
	<xhtml:head>
		<xhtml:title>nomisma.org: Administrative Interface</xhtml:title>
		<xhtml:link rel="stylesheet" type="text/css" href="/apps/nomisma/css/grids-min.css"/>
		<xhtml:link rel="stylesheet" type="text/css" href="/apps/nomisma/css/reset-fonts-grids.css"/>
		<xhtml:link rel="stylesheet" type="text/css" href="/apps/nomisma/css/base-min.css"/>
		<xhtml:link rel="stylesheet" type="text/css" href="/apps/nomisma/css/fonts-min.css"/>

		<!-- nomisma styling -->
		<xhtml:link rel="stylesheet" href="/apps/nomisma/css/style.css"/>
		<!--<xhtml:link rel="stylesheet" href="/apps/nomisma/css/themes/smoothness.css"/>-->

		<!--<xhtml:script type="text/javascript" src="/apps/nomisma/javascript/jquery-1.4.2.min.js"/>
		<xhtml:script type="text/javascript" src="/apps/nomisma/javascript/get_components.js"/>
		<xhtml:script type="text/javascript" src="/apps/nomisma/javascript/menu.js"/>-->


		<xforms:model>
			<xforms:instance id="doc">
				<rdf:RDF xmlns:batlas="http://atlantides.org/batlas/" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:foaf="http://xmlns.com/foaf/0.1/"
					xmlns:gml="http://www.opengis.net/gml/" xmlns:nm="http://nomisma.org/id/" xmlns:ov="http://open.vocab.org/terms/" xmlns:owl="http://www.w3.org/2002/07/owl#"
					xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns:skos="http://www.w3.org/2008/05/skos#"
					xmlns:xhv="http://www.w3.org/1999/xhtml/vocab#" xmlns:xml="http://www.w3.org/XML/1998/namespace">
					<rdf:Description rdf:about="http://nomisma.org/id/">
						<dc:title xml:lang="en">Nomisma.org</dc:title>
						<cc:attributionName xml:lang="en">http://nomisma.org</cc:attributionName>
						<xhv:license rdf:resource="http://creativecommons.org/licenses/by-nc/3.0/"/>
						<cc:attributionURL rdf:resource="http://nomisma.org"/>
					</rdf:Description>
					<nm:mint rdf:about="http://nomisma.org/id/athens">

						<skos:definition xml:lang="en">The mint at the ancient site of Athens in Attica.</skos:definition>
						<skos:related rdf:resource="http://pleiades.stoa.org/places/579885"/>
						<skos:related rdf:resource="http://en.wikipedia.org/wiki/Athens"/>
						<gml:pos xml:lang="en">37.974722 23.7225</gml:pos>
						<nm:head1911region rdf:resource="http://nomisma.org/id/attica"/>
						<nm:latlongsource rdf:resource="http://en.wikipedia.org/wiki/Athens"/>
						<skos:prefLabel xml:lang="en">Athens</skos:prefLabel>

					</nm:mint>
				</rdf:RDF>
			</xforms:instance>

			<xforms:instance id="control-instance">
				<controls xmlns="">
					<id/>
					<type/>
					<prefLabel/>
					<lat/>
					<lon/>
				</controls>
			</xforms:instance>

			<xforms:instance id="nm-templates">
				<templates xmlns="">
					<nm:mint rdf:about="">
						<skos:prefLabel xml:lang="en"/>
					</nm:mint>
					<nm:material rdf:about="">
						<skos:prefLabel xml:lang="en"/>
					</nm:material>
				</templates>
			</xforms:instance>

			<xforms:instance id="types">
				<types>
					<type>material</type>
					<type>mint</type>
				</types>
			</xforms:instance>
			
			<xforms:instance id="languages">
				<languages>
					<language>en</language>
					<language>fr</language>
				</languages>
			</xforms:instance>

			<xforms:instance id="related-template">
				<skos:related rdf:resource="" xmlns=""/>
			</xforms:instance>
			<xforms:instance id="definition-template">
				<skos:definition xml:lang="en" xmlns=""/>
			</xforms:instance>

			<xforms:bind nodeset="instance('control-instance')">
				<xforms:bind nodeset="id" required="true()" type="xs:anyURI"/>
				<xforms:bind nodeset="type">
					<xforms:bind constraint="string-length(.) &gt; 0"/>
				</xforms:bind>
				<xforms:bind nodeset="prefLabel" required="true()"/>
				<xforms:bind nodeset="lat" type="xs:double"/>
				<xforms:bind nodeset="lon" type="xs:double"/>
			</xforms:bind>

			<xforms:bind nodeset="instance('doc')">
				<xforms:bind nodeset="rdf:Description/following-sibling::*">
					<xforms:bind nodeset="skos:related" required="true()"/>
				</xforms:bind>
			</xforms:bind>

			<xforms:action ev:event="xforms-model-construct-done">
				<xforms:setvalue ref="instance('control-instance')/id" value="substring-after(instance('doc')/rdf:Description/following-sibling::*/@rdf:about, 'http://nomisma.org/id/')"/>
				<xforms:setvalue ref="instance('control-instance')/prefLabel" value="instance('doc')/rdf:Description/following-sibling::*/skos:prefLabel"/>
				<xforms:setvalue ref="instance('control-instance')/type" value="instance('doc')/rdf:Description/following-sibling::*/local-name()"/>
			</xforms:action>
		</xforms:model>

	</xhtml:head>

	<xhtml:body class="yui-skin-sam">
		<xhtml:div id="doc4">
			<!-- header -->
			<xxforms:variable name="display_path">../</xxforms:variable>
			<xi:include href="header-admin.xml"/>

			<xhtml:div id="bd">
				<xhtml:div id="form">
					<h1>Edit nomisma id</h1>
					<h2>Options</h2>
					<div class="trigger_container">
						<xforms:group ref=".[count(instance('doc')//skos:definition) = 0]">
							<xforms:trigger appearance="minimal">
								<xforms:label>
									<xhtml:img src="/apps/nomisma/images/add.gif"/>Definition</xforms:label>
								<xforms:insert ev:event="DOMActivate" origin="instance('definition-template')" context="rdf:Description/following-sibling::*"/>
							</xforms:trigger>
						</xforms:group>
						<xforms:trigger appearance="minimal">
							<xforms:label>
								<xhtml:img src="/apps/nomisma/images/add.gif"/>Related Link</xforms:label>
							<xforms:insert ev:event="DOMActivate" origin="instance('related-template')" context="rdf:Description/following-sibling::*"/>
						</xforms:trigger>
					</div>
					<div>
						<xforms:select1 ref="instance('control-instance')/type">
							<xforms:label>Type</xforms:label>
							<xforms:alert>Required</xforms:alert>
							<xforms:item>
								<xforms:label>Select...</xforms:label>
								<xforms:value/>
							</xforms:item>
							<xforms:itemset nodeset="instance('types')/type">
								<xforms:label ref="."/>
								<xforms:value ref="."/>
							</xforms:itemset>
							<xforms:action ev:event="xforms-value-changed">
								<xxforms:variable name="type" select="."/>
								<!-- if altering the type from its original value, remove the nm:* and replace with the new type-->
								<xforms:action if="$type != instance('doc')/rdf:Description/following-sibling::*/local-name()">
									<xforms:delete nodeset="instance('doc')/rdf:Description/following-sibling::*"/>
									<xforms:insert origin="instance('nm-templates')/*[local-name()=$type]" context="instance('doc')" nodeset="./child::node()[last()]"/>
									<!-- set rdf:resource and prefLabel -->
									<xforms:setvalue ref="instance('doc')/rdf:Description/following-sibling::*/@rdf:about" value="concat('http://nomisma.org/id/', instance('control-instance')/id)"/>
									<xforms:setvalue ref="instance('doc')/rdf:Description/following-sibling::*/skos:prefLabel" value="instance('control-instance')/prefLabel"/>
								</xforms:action>
							</xforms:action>
						</xforms:select1>
					</div>
					<div>
						<xforms:input ref="instance('control-instance')/id">
							<xforms:label>id</xforms:label>
							<xforms:alert>Required</xforms:alert>
							<xforms:action ev:event="xforms-value-changed">
								<xforms:setvalue ref="instance('doc')/rdf:Description/following-sibling::*/@rdf:about" value="concat('http://nomisma.org/id/', instance('control-instance')/id)"/>
							</xforms:action>
						</xforms:input>
					</div>
					<div>
						<xforms:input ref="instance('control-instance')/prefLabel">
							<xforms:label>Preferred Label</xforms:label>
							<xforms:alert>Required</xforms:alert>
							<xforms:action ev:event="xforms-value-changed">
								<xforms:setvalue ref="instance('doc')/rdf:Description/following-sibling::*/skos:prefLabel" value="instance('control-instance')/prefLabel"/>
							</xforms:action>
						</xforms:input>
					</div>
					<xforms:group ref="instance('doc')/rdf:Description/following-sibling::*">
						<xforms:group ref="skos:definition">
							<div>
								<xforms:input ref=".">
									<xforms:label>Definition</xforms:label>
									<xforms:alert>Required</xforms:alert>
								</xforms:input>
								<xforms:select1 ref="@xml:lang">
									<xforms:itemset nodeset="instance('languages')/language">
										<xforms:label ref="."/>
										<xforms:value ref="."/>
									</xforms:itemset>
								</xforms:select1>
								<xforms:trigger appearance="minimal">
									<xforms:delete ev:event="DOMActivate" context="."/>
									<xforms:label>
										<xhtml:img src="/apps/nomisma/images/remove.gif"/>
									</xforms:label>
								</xforms:trigger>
							</div>
						</xforms:group>
						<xforms:repeat nodeset="skos:related">
							<div>
								<xforms:input ref="@rdf:resource">
									<xforms:label>Related Link</xforms:label>
									<xforms:alert>Required</xforms:alert>
								</xforms:input>
								<xforms:trigger appearance="minimal">
									<xforms:delete ev:event="DOMActivate" context="."/>
									<xforms:label>
										<xhtml:img src="/apps/nomisma/images/remove.gif"/>
									</xforms:label>
								</xforms:trigger>
							</div>
						</xforms:repeat>

					</xforms:group>


				</xhtml:div>
				<fr:xforms-inspector/>
			</xhtml:div>

			<!-- footer -->
			<!--<xi:include href="footer.xml"/>-->
		</xhtml:div>
	</xhtml:body>
</xhtml:html>
